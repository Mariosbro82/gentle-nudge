import{c as k,r as i,j as e,a as I,u as _e,s as y}from"./index-CdJipTJO.js";import{T as Ce,a as Ee,b as G,c as P,d as Se,e as E,B as Pe}from"./table-Iy6iH93X.js";import{u as Z,c as Re,B as f}from"./button-DuQyEyRp.js";import{u as ke,a as W,c as R,P as X,b as Ie,h as ze,d as Ae,R as Oe,e as Te,F as Fe,D as Me,f as Le,S as se,g as ae,i as ne,j as re,k as T}from"./select-Dp9fjKJz.js";import{P as z,I as F}from"./input-CYLGLQaJ.js";import{L as S,a as q}from"./label-BVAcjJAR.js";import"./index-Ckf17XvL.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ge=k("plus",$e);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],qe=k("square-pen",We);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],He=k("trash",Be);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ve=k("triangle-alert",Ue);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ze=k("x",Ke);var L="Dialog",[oe]=Ae(L),[Xe,m]=oe(L),ie=t=>{const{__scopeDialog:s,children:r,open:n,defaultOpen:o,onOpenChange:a,modal:c=!0}=t,d=i.useRef(null),g=i.useRef(null),[j,b]=ke({prop:n,defaultProp:o??!1,onChange:a,caller:L});return e.jsx(Xe,{scope:s,triggerRef:d,contentRef:g,contentId:W(),titleId:W(),descriptionId:W(),open:j,onOpenChange:b,onOpenToggle:i.useCallback(()=>b($=>!$),[b]),modal:c,children:r})};ie.displayName=L;var le="DialogTrigger",ce=i.forwardRef((t,s)=>{const{__scopeDialog:r,...n}=t,o=m(le,r),a=Z(s,o.triggerRef);return e.jsx(z.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Q(o.open),...n,ref:a,onClick:R(t.onClick,o.onOpenToggle)})});ce.displayName=le;var Y="DialogPortal",[Ye,de]=oe(Y,{forceMount:void 0}),ue=t=>{const{__scopeDialog:s,forceMount:r,children:n,container:o}=t,a=m(Y,s);return e.jsx(Ye,{scope:s,forceMount:r,children:i.Children.map(n,c=>e.jsx(X,{present:r||a.open,children:e.jsx(Ie,{asChild:!0,container:o,children:c})}))})};ue.displayName=Y;var M="DialogOverlay",he=i.forwardRef((t,s)=>{const r=de(M,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,a=m(M,t.__scopeDialog);return a.modal?e.jsx(X,{present:n||a.open,children:e.jsx(Qe,{...o,ref:s})}):null});he.displayName=M;var Je=Re("DialogOverlay.RemoveScroll"),Qe=i.forwardRef((t,s)=>{const{__scopeDialog:r,...n}=t,o=m(M,r);return e.jsx(Oe,{as:Je,allowPinchZoom:!0,shards:[o.contentRef],children:e.jsx(z.div,{"data-state":Q(o.open),...n,ref:s,style:{pointerEvents:"auto",...n.style}})})}),_="DialogContent",ge=i.forwardRef((t,s)=>{const r=de(_,t.__scopeDialog),{forceMount:n=r.forceMount,...o}=t,a=m(_,t.__scopeDialog);return e.jsx(X,{present:n||a.open,children:a.modal?e.jsx(et,{...o,ref:s}):e.jsx(tt,{...o,ref:s})})});ge.displayName=_;var et=i.forwardRef((t,s)=>{const r=m(_,t.__scopeDialog),n=i.useRef(null),o=Z(s,r.contentRef,n);return i.useEffect(()=>{const a=n.current;if(a)return ze(a)},[]),e.jsx(me,{...t,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:R(t.onCloseAutoFocus,a=>{var c;a.preventDefault(),(c=r.triggerRef.current)==null||c.focus()}),onPointerDownOutside:R(t.onPointerDownOutside,a=>{const c=a.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0;(c.button===2||d)&&a.preventDefault()}),onFocusOutside:R(t.onFocusOutside,a=>a.preventDefault())})}),tt=i.forwardRef((t,s)=>{const r=m(_,t.__scopeDialog),n=i.useRef(!1),o=i.useRef(!1);return e.jsx(me,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{var c,d;(c=t.onCloseAutoFocus)==null||c.call(t,a),a.defaultPrevented||(n.current||(d=r.triggerRef.current)==null||d.focus(),a.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:a=>{var g,j;(g=t.onInteractOutside)==null||g.call(t,a),a.defaultPrevented||(n.current=!0,a.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const c=a.target;((j=r.triggerRef.current)==null?void 0:j.contains(c))&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&o.current&&a.preventDefault()}})}),me=i.forwardRef((t,s)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:a,...c}=t,d=m(_,r),g=i.useRef(null),j=Z(s,g);return Te(),e.jsxs(e.Fragment,{children:[e.jsx(Fe,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:a,children:e.jsx(Me,{role:"dialog",id:d.contentId,"aria-describedby":d.descriptionId,"aria-labelledby":d.titleId,"data-state":Q(d.open),...c,ref:j,onDismiss:()=>d.onOpenChange(!1)})}),e.jsxs(e.Fragment,{children:[e.jsx(st,{titleId:d.titleId}),e.jsx(nt,{contentRef:g,descriptionId:d.descriptionId})]})]})}),J="DialogTitle",pe=i.forwardRef((t,s)=>{const{__scopeDialog:r,...n}=t,o=m(J,r);return e.jsx(z.h2,{id:o.titleId,...n,ref:s})});pe.displayName=J;var xe="DialogDescription",fe=i.forwardRef((t,s)=>{const{__scopeDialog:r,...n}=t,o=m(xe,r);return e.jsx(z.p,{id:o.descriptionId,...n,ref:s})});fe.displayName=xe;var je="DialogClose",be=i.forwardRef((t,s)=>{const{__scopeDialog:r,...n}=t,o=m(je,r);return e.jsx(z.button,{type:"button",...n,ref:s,onClick:R(t.onClick,()=>o.onOpenChange(!1))})});be.displayName=je;function Q(t){return t?"open":"closed"}var ve="DialogTitleWarning",[Dt,Ne]=Le(ve,{contentName:_,titleName:J,docsSlug:"dialog"}),st=({titleId:t})=>{const s=Ne(ve),r=`\`${s.contentName}\` requires a \`${s.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${s.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${s.docsSlug}`;return i.useEffect(()=>{t&&(document.getElementById(t)||console.error(r))},[r,t]),null},at="DialogDescriptionWarning",nt=({contentRef:t,descriptionId:s})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Ne(at).contentName}}.`;return i.useEffect(()=>{var a;const o=(a=t.current)==null?void 0:a.getAttribute("aria-describedby");s&&o&&(document.getElementById(s)||console.warn(n))},[n,t,s]),null},rt=ie,ot=ce,it=ue,lt=he,ct=ge,dt=pe,ut=fe,ht=be;function B({...t}){return e.jsx(rt,{"data-slot":"dialog",...t})}function gt({...t}){return e.jsx(ot,{"data-slot":"dialog-trigger",...t})}function mt({...t}){return e.jsx(it,{"data-slot":"dialog-portal",...t})}function pt({className:t,...s}){return e.jsx(lt,{"data-slot":"dialog-overlay",className:I("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function H({className:t,children:s,showCloseButton:r=!0,...n}){return e.jsxs(mt,{"data-slot":"dialog-portal",children:[e.jsx(pt,{}),e.jsxs(ct,{"data-slot":"dialog-content",className:I("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 outline-none sm:max-w-lg",t),...n,children:[s,r&&e.jsxs(ht,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Ze,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function U({className:t,...s}){return e.jsx("div",{"data-slot":"dialog-header",className:I("flex flex-col gap-2 text-center sm:text-left",t),...s})}function V({className:t,...s}){return e.jsx(dt,{"data-slot":"dialog-title",className:I("text-lg leading-none font-semibold",t),...s})}function K({className:t,...s}){return e.jsx(ut,{"data-slot":"dialog-description",className:I("text-muted-foreground text-sm",t),...s})}function wt(){var te;const{user:t}=_e(),[s,r]=i.useState(!0),[n,o]=i.useState([]),[a,c]=i.useState([]),[d,g]=i.useState(!1),[j,b]=i.useState(!1),[$,A]=i.useState(!1),[h,ee]=i.useState(null),[x,v]=i.useState(!1),[C,p]=i.useState(null);async function O(){if(!t)return;const{data:l}=await y.from("users").select("id, company_id").eq("id",t.id).single();let u=y.from("chips").select("*, assigned_user:users(name)");l!=null&&l.company_id?u=u.eq("company_id",l.company_id):u=u.eq("assigned_user_id",t.id);const{data:D}=await u;o(D||[]);const{data:w}=await y.from("companies").select("id, name");c(w||[]),r(!1)}i.useEffect(()=>{O()},[t]);async function ye(l){l.preventDefault(),v(!0),p(null);const u=new FormData(l.currentTarget),D=u.get("uid"),w=u.get("company_id"),{error:N}=await y.from("chips").insert({uid:D.replace(/:/g,"").toUpperCase(),company_id:w||null,assigned_user_id:t==null?void 0:t.id,active_mode:"corporate"});N?p(N.message):(await O(),g(!1)),v(!1)}async function De(l){l.preventDefault(),v(!0),p(null);const u=new FormData(l.currentTarget),D=u.get("password"),{error:w}=await y.auth.signInWithPassword({email:(t==null?void 0:t.email)||"",password:D});if(w){p("Falsches Passwort"),v(!1);return}const{error:N}=await y.from("chips").update({uid:u.get("uid"),active_mode:u.get("active_mode")}).eq("id",h==null?void 0:h.id);N?p(N.message):(await O(),b(!1)),v(!1)}async function we(l){l.preventDefault(),v(!0),p(null);const D=new FormData(l.currentTarget).get("password"),{error:w}=await y.auth.signInWithPassword({email:(t==null?void 0:t.email)||"",password:D});if(w){p("Falsches Passwort"),v(!1);return}const{error:N}=await y.from("chips").delete().eq("id",h==null?void 0:h.id);N?p(N.message):(await O(),A(!1)),v(!1)}return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"h-6 w-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Geräte"}),e.jsx("p",{className:"text-zinc-500",children:"Verwalten Sie alle NFC-Chips und deren aktive Modi."})]}),e.jsxs(B,{open:d,onOpenChange:g,children:[e.jsx(gt,{asChild:!0,children:e.jsxs(f,{className:"bg-white text-black hover:bg-zinc-200",children:[e.jsx(Ge,{size:18,className:"mr-2"})," Chip hinzufügen"]})}),e.jsxs(H,{className:"bg-zinc-900 border-zinc-800 text-white",children:[e.jsxs(U,{children:[e.jsx(V,{children:"Neuen NFC-Chip registrieren"}),e.jsx(K,{className:"text-zinc-400",children:"Geben Sie die UID des NTAG424 DNA Chips ein."})]}),e.jsxs("form",{onSubmit:ye,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"uid",children:"Chip UID (Hex)"}),e.jsx(F,{name:"uid",placeholder:"04:A1:B2:C3:D4:E5:F6",className:"bg-black/50 border-white/10 font-mono",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"company_id",children:"Firma zuweisen"}),e.jsxs(se,{name:"company_id",children:[e.jsx(ae,{className:"bg-black/50 border-white/10",children:e.jsx(ne,{placeholder:"Firma wählen"})}),e.jsx(re,{className:"bg-zinc-900 border-zinc-800 text-white",children:a.map(l=>e.jsx(T,{value:l.id,children:l.name},l.id))})]})]}),C&&e.jsx("p",{className:"text-red-400 text-sm",children:C}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(f,{type:"button",variant:"ghost",onClick:()=>g(!1),disabled:x,children:"Abbrechen"}),e.jsx(f,{type:"submit",className:"bg-blue-600 hover:bg-blue-500",disabled:x,children:x?e.jsx(q,{className:"animate-spin mr-2 h-4 w-4"}):"Chip erstellen"})]})]})]})]})]}),e.jsx("div",{className:"rounded-md border border-white/5 bg-zinc-900/50",children:e.jsxs(Ce,{children:[e.jsx(Ee,{children:e.jsxs(G,{className:"border-white/5 hover:bg-white/5",children:[e.jsx(P,{children:"UID"}),e.jsx(P,{children:"Zugewiesen an"}),e.jsx(P,{children:"Aktiver Modus"}),e.jsx(P,{children:"Letzter Scan"}),e.jsx(P,{className:"text-right",children:"Aktionen"})]})}),e.jsxs(Se,{children:[n.map(l=>{var u;return e.jsxs(G,{className:"border-white/5 hover:bg-white/5",children:[e.jsx(E,{className:"font-mono text-zinc-400",children:l.uid?`****${l.uid.slice(-4).toUpperCase()}`:"-"}),e.jsx(E,{className:"font-medium text-white",children:((u=l.assigned_user)==null?void 0:u.name)||"-"}),e.jsx(E,{children:e.jsx(Pe,{variant:"outline",className:l.active_mode==="corporate"?"border-blue-500 text-blue-400":l.active_mode==="hospitality"?"border-orange-500 text-orange-400":"border-purple-500 text-purple-400",children:l.active_mode})}),e.jsx(E,{className:"text-zinc-500",children:l.last_scan?new Date(l.last_scan).toLocaleDateString():"Nie"}),e.jsx(E,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{ee(l),p(null),b(!0)},children:e.jsx(qe,{size:16})}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-400 hover:text-red-300",onClick:()=>{ee(l),p(null),A(!0)},children:e.jsx(He,{size:16})})]})})]},l.id)}),n.length===0&&e.jsx(G,{children:e.jsx(E,{colSpan:5,className:"text-center py-10 text-zinc-500",children:"Keine Geräte gefunden. Fügen Sie eines hinzu."})})]})]})}),e.jsx(B,{open:j,onOpenChange:b,children:e.jsxs(H,{className:"bg-zinc-900 border-zinc-800 text-white",children:[e.jsxs(U,{children:[e.jsx(V,{children:"Chip bearbeiten"}),e.jsx(K,{className:"text-zinc-400",children:"Ändern Sie die Einstellungen für diesen NFC-Chip."})]}),e.jsxs("form",{onSubmit:De,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"uid",children:"Chip UID"}),e.jsx(F,{name:"uid",defaultValue:h==null?void 0:h.uid,className:"bg-black/50 border-white/10 font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"active_mode",children:"Aktiver Modus"}),e.jsxs(se,{name:"active_mode",defaultValue:h==null?void 0:h.active_mode,children:[e.jsx(ae,{className:"bg-black/50 border-white/10",children:e.jsx(ne,{})}),e.jsxs(re,{className:"bg-zinc-900 border-zinc-800 text-white",children:[e.jsx(T,{value:"corporate",children:"Corporate"}),e.jsx(T,{value:"hospitality",children:"Hospitality"}),e.jsx(T,{value:"event",children:"Event"})]})]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-white/10",children:[e.jsx(S,{htmlFor:"password",className:"text-orange-400",children:"Passwort zur Bestätigung"}),e.jsx(F,{name:"password",type:"password",placeholder:"Ihr Konto-Passwort",className:"bg-black/50 border-orange-500/30",required:!0}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Geben Sie Ihr Passwort ein, um die Änderungen zu bestätigen."})]}),C&&e.jsx("p",{className:"text-red-400 text-sm",children:C}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(f,{type:"button",variant:"ghost",onClick:()=>b(!1),disabled:x,children:"Abbrechen"}),e.jsxs(f,{type:"submit",className:"bg-blue-600 hover:bg-blue-500",disabled:x,children:[x?e.jsx(q,{className:"animate-spin mr-2 h-4 w-4"}):null,"Speichern"]})]})]})]})}),e.jsx(B,{open:$,onOpenChange:A,children:e.jsxs(H,{className:"bg-zinc-900 border-zinc-800 text-white",children:[e.jsxs(U,{children:[e.jsxs(V,{className:"flex items-center gap-2 text-red-400",children:[e.jsx(Ve,{size:20}),"Chip löschen"]}),e.jsx(K,{className:"text-zinc-400",children:"Diese Aktion kann nicht rückgängig gemacht werden. Alle Scan-Daten bleiben erhalten."})]}),e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg my-4",children:e.jsxs("p",{className:"text-sm text-red-300",children:["Sie sind dabei, den Chip"," ",e.jsxs("span",{className:"font-mono font-bold",children:["****",(te=h==null?void 0:h.uid)==null?void 0:te.slice(-4).toUpperCase()]})," dauerhaft zu löschen."]})}),e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"password",className:"text-red-400",children:"Passwort zur Bestätigung"}),e.jsx(F,{name:"password",type:"password",placeholder:"Ihr Konto-Passwort",className:"bg-black/50 border-red-500/30",required:!0}),e.jsx("p",{className:"text-xs text-zinc-500",children:"Geben Sie Ihr Passwort ein, um die Löschung zu bestätigen."})]}),C&&e.jsx("p",{className:"text-red-400 text-sm",children:C}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(f,{type:"button",variant:"ghost",onClick:()=>A(!1),disabled:x,children:"Abbrechen"}),e.jsxs(f,{type:"submit",className:"bg-red-600 hover:bg-red-500",disabled:x,children:[x?e.jsx(q,{className:"animate-spin mr-2 h-4 w-4"}):null,"Endgültig löschen"]})]})]})]})})]})}export{wt as default};
